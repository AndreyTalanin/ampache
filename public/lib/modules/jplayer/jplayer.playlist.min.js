/*! jPlayerPlaylist for jPlayer 2.9.2 ~ (c) 2009-2014 Happyworm Ltd ~ MIT License */
!function(t,s){jPlayerPlaylist=function(s,e,l){var i=this;this.current=0,this.loop=!1,this.shuffling=!1,this.removing=!1,this.cssSelector=t.extend({},this._cssSelector,s),this.options=t.extend(!0,{keyBindings:{shuffle:{key:83,fn:function(){i.shuffle()}},next:{key:78,fn:function(){i.next()}},previous:{key:66,fn:function(){i.previous()}}},stateClass:{shuffled:"jp-state-shuffled"}},this._options,l),this.playlist=[],this.cssSelector.details=this.cssSelector.cssSelectorAncestor+" .jp-details",this.cssSelector.playlist=this.cssSelector.cssSelectorAncestor+" .jp-playlist",this.cssSelector.next=this.cssSelector.cssSelectorAncestor+" .jp-next",this.cssSelector.previous=this.cssSelector.cssSelectorAncestor+" .jp-previous",this.cssSelector.shuffle=this.cssSelector.cssSelectorAncestor+" .jp-shuffle",this.cssSelector.shuffleOff=this.cssSelector.cssSelectorAncestor+" .jp-shuffle-off",this.options.cssSelectorAncestor=this.cssSelector.cssSelectorAncestor,this.options.repeat=function(t){console.log("repeat "+t.jPlayer.options.loop),i.loop=t.jPlayer.options.loop},t(this.cssSelector.jPlayer).bind(t.jPlayer.event.ready,function(){i._init()}),t(this.cssSelector.jPlayer).bind(t.jPlayer.event.ended,function(){i.next()}),t(this.cssSelector.jPlayer).bind(t.jPlayer.event.play,function(){t(this).jPlayer("pauseOthers")}),t(this.cssSelector.jPlayer).bind(t.jPlayer.event.resize,function(s){s.jPlayer.options.fullScreen?t(i.cssSelector.details).show():t(i.cssSelector.details).hide()}),t(this.cssSelector.previous).click(function(t){t.preventDefault(),i.previous(),i.blur(this)}),t(this.cssSelector.next).click(function(t){t.preventDefault(),i.next(),i.blur(this)}),t(this.cssSelector.shuffle).click(function(t){t.preventDefault(),i.shuffle(),i.blur(this)}),t(this.cssSelector.shuffleOff).click(function(t){t.preventDefault(),i.shuffling=!1,i.shuffle(),i.blur(this)}).hide(),this.options.fullScreen||t(this.cssSelector.details).hide(),t(this.cssSelector.playlist+" ul").empty(),this._createItemHandlers(),t(this.cssSelector.jPlayer).jPlayer(this.options)},jPlayerPlaylist.prototype={_cssSelector:{jPlayer:"#jquery_jplayer_1",cssSelectorAncestor:"#jp_container_1"},_options:{playlistOptions:{autoPlay:!1,removePlayed:!1,removeCount:0,loopBack:!1,shuffleOnLoop:!1,enableRemoveControls:!1,displayTime:"slow",addTime:"fast",removeTime:"fast",shuffleTime:"slow",itemClass:"jp-playlist-item",freeGroupClass:"jp-free-media",freeItemClass:"jp-playlist-item-free",removeItemClass:"jp-playlist-item-remove"}},option:function(t,s){if(void 0===s)return this.options.playlistOptions[t];switch(this.options.playlistOptions[t]=s,t){case"enableRemoveControls":this._updateControls();break;case"itemClass":case"freeGroupClass":case"freeItemClass":case"removeItemClass":this._refresh(!0),this._createItemHandlers()}return this},_init:function(){var t=this;this._refresh(function(){t.options.playlistOptions.autoPlay?t.play(t.current):t.setCurrent(t.current)})},_initPlaylist:function(){this.current=0,this.removing=!1,this.playlist=[]},_refresh:function(s){var e=this;if(s&&!t.isFunction(s))t(this.cssSelector.playlist+" ul").empty(),t.each(e.playlist,function(s){t(e.cssSelector.playlist+" ul").append(e._createListItem(e.playlist[s]))}),this._updateControls();else{var l=t(this.cssSelector.playlist+" ul").children().length?this.options.playlistOptions.displayTime:0;t(this.cssSelector.playlist+" ul").slideUp(l,function(){var l=t(this);t(this).empty(),t.each(e.playlist,function(t){l.append(e._createListItem(e.playlist[t]))}),e._updateControls(),t.isFunction(s)&&s(),e.playlist.length?t(this).slideDown(e.options.playlistOptions.displayTime):t(this).show()})}},_refreshHtmlPlaylist:function(){console.log("_refreshHtmlPlaylist");var s=this.current;t.each(t(this.cssSelector.playlist+" ul li"),function(e,l){var i=parseInt(t(l).attr("name"),10);i!==e&&(s===i&&(console.log("this.current: "+s+" => "+e),console.log(l),s=e),t(l).attr("name",e))}),this.current=s},_createListItem:function(s){var e=' class="playlist-row ';"string"==typeof s.attrClass&&(e+=s.attrClass);var l="<li"+(e+='" ')+' name="'+t(jplaylist.cssSelector.playlist+" ul li").length+'" data-poster="'+s.poster+'" data-media_id="'+s.media_id+'" data-album_id="'+s.album_id+'" data-albumdisk_id="'+s.albumdisk_id+'" data-artist_id="'+s.artist_id+'" data-replaygain_track_gain="'+s.replaygain_track_gain+'" data-replaygain_track_peak="'+s.replaygain_track_peak+'" data-replaygain_album_gain="'+s.replaygain_album_gain+'" data-replaygain_album_peak="'+s.replaygain_album_peak+'" data-r128_track_gain="'+s.r128_track_gain+'" data-r128_album_gain="'+s.r128_album_gain+'"><div>';return l+="<a href='javascript:;' class='"+this.options.playlistOptions.removeItemClass+"'>&times;</a>",s.media_id&&(l+='<span class="jp-free-media menu"><a></a></span>'),l+="<a href='javascript:;' class='"+this.options.playlistOptions.itemClass+"' tabindex='1'>"+s.title+(s.artist?" <span class='jp-artist'>by "+s.artist+"</span>":"")+"</a>",l+="</div></li>"},_createItemHandlers:function(){var s=this;t(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.itemClass).on("click","a."+this.options.playlistOptions.itemClass,function(e){e.preventDefault();var l=t(this).parent().parent().index();s.current!==l?s.play(l):t(s.cssSelector.jPlayer).jPlayer("play"),s.blur(this)}),t(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.freeItemClass).on("click","a."+this.options.playlistOptions.freeItemClass,function(e){e.preventDefault(),t(this).parent().parent().find("."+s.options.playlistOptions.itemClass).click(),s.blur(this)}),t(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.removeItemClass).on("click","a."+this.options.playlistOptions.removeItemClass,function(e){e.preventDefault();var l=t(this).parent().parent().index();s.remove(l),s.blur(this)})},_updateControls:function(){this.options.playlistOptions.enableRemoveControls?t(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).show():t(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).hide(),this.shuffling?t(this.cssSelector.jPlayer).jPlayer("addStateClass","shuffled"):t(this.cssSelector.jPlayer).jPlayer("removeStateClass","shuffled"),t(this.cssSelector.shuffle).length&&t(this.cssSelector.shuffleOff).length&&(this.shuffling?(t(this.cssSelector.shuffleOff).show(),t(this.cssSelector.shuffle).hide()):(t(this.cssSelector.shuffleOff).hide(),t(this.cssSelector.shuffle).show()))},_highlight:function(s){console.log("_highlight "+s),t(this.cssSelector.title+" li:first").html("Playlist: "+this.name),t(this.cssSelector.title+" li:last").html(" "),this.playlist.length&&void 0!==s&&(t(this.cssSelector.playlist+" .jp-playlist-current").removeClass("jp-playlist-current"),t(this.cssSelector.playlist+" li:nth-child("+(s+1)+")").addClass("jp-playlist-current").find(".jp-playlist-item").addClass("jp-playlist-current"),t(this.cssSelector.title+" li:last").html(this.playlist[s].title+(this.playlist[s].artist?" <span class='jp-artist'>by "+this.playlist[s].artist+"</span>":"")))},add:function(s,e){console.log("add");var l=this.playlist,i=[];t(this.cssSelector.playlist+" ul").append(this._createListItem(s)).find("li:last-child").hide().slideDown(this.options.playlistOptions.addTime),this._updateControls(),t.each(this.playlist,function(t){i.push(l[t])}),i.push(s),this.playlist=i,this.original=i,console.log("current: "+this.current),console.log(l),console.log(this.playlist),console.log("-----------"),e?this.play(this.playlist.length-1):1===this.playlist.length&&this.select(0)},addAfter:function(s,e){if(console.log("addAfter "+e),e>=this.playlist.length||e<0)console.log("jPlayerPlaylist.addAfter: ERROR, Index out of bounds");else{var l=this.playlist,i=[];t(this.cssSelector.playlist+" ul").find("li[name="+e+"]").after(this._createListItem(s)).end().find("li:last-child").hide().slideDown(this.options.playlistOptions.addTime),this._updateControls(),t.each(this.playlist,function(t){i.push(l[t]),t===e&&i.push(s)}),this.playlist=i,this.original=i,1===this.playlist.length&&this.select(0),this._refreshHtmlPlaylist(),console.log("current: "+this.current),console.log(l),console.log(this.playlist),console.log("-----------")}},remove:function(s){console.log("remove "+s);var e=this;if(void 0===s)return this._initPlaylist(),this._refresh(function(){t(e.cssSelector.jPlayer).jPlayer("clearMedia")}),!0;var l=0,i=e.current,o=e.playlist,a=[];return!this.removing&&(0<=(s=s<0?this.playlist.length+s:s)&&s<this.playlist.length&&(this.removing=!0,t.each(t(this.cssSelector.playlist+" ul li"),function(r,n){var c=parseInt(t(n).attr("name"),10);c===s?t(n).remove():((i===c||t(n).hasClass("jp-playlist-current"))&&(console.log("this.current: "+i+" => "+l),console.log(n),e.current=l),t(n).attr("name",l),a.push(o[c]),l++)}),this.removing=!1,this.current=e.current,this.playlist=a,this.original=a),this._refreshHtmlPlaylist(),console.log("current: "+this.current),console.log(o),console.log(e.playlist),console.log("-----------"),!0)},removeBefore:function(s){console.log("removeBefore "+s);var e=this;if(void 0===s)return this._initPlaylist(),this._refresh(function(){t(e.cssSelector.jPlayer).jPlayer("clearMedia")}),!0;var l=0,i=e.current,o=e.playlist,a=[];return!this.removing&&(0<=(s=s<0?this.playlist.length+s:s)&&s<=this.playlist.length&&(this.removing=!0,t.each(t(this.cssSelector.playlist+" ul li"),function(r,n){var c=parseInt(t(n).attr("name"),10);c<s?t(n).remove():((i===c||t(n).hasClass("jp-playlist-current"))&&(console.log("this.current: "+i+" => "+l),console.log(n),e.current=l),t(n).attr("name",l),a.push(o[c]),l++)}),this.removing=!1,this.playlist=a,this.original=a),console.log("current: "+e.current),console.log(o),console.log(e.playlist),console.log("-----------"),!0)},removeAll:function(){this.original=[],t(this.cssSelector.playlist+" ul").html(" ")},rmTrack:function(s,e){e=e||"default",t.post("/playlist/rmtrack",{playlist:e,trackId:s},function(s){"error"===s[1]&&t.loadPlaylist()},"json").error(function(s){t.bootstrapMessageAuto("An error occurred while trying to remove the track from your playlist.","error")})},scan:function(){console.log("scan "+this.current);var s=this,e=!1,l=s.current,i=s.playlist,o=[];t.each(t(this.cssSelector.playlist+" ul li"),function(a,r){var n=parseInt(t(r).attr("name"),10);n!==a&&(e||l!==n&&!t(r).hasClass("jp-playlist-current")||(console.log("this.current: "+l+" => "+a),console.log(r),s.current=a,e=!0),t(r).attr("name",a)),o.push(i[n])}),s.playlist=o,console.log("current: "+s.current),console.log(i),console.log(s.playlist),console.log("-----------")},select:function(s){console.log("select "+s),0<=(s=s<0?this.playlist.length+s:s)&&s<this.playlist.length?(this.current=s,this._highlight(s),t(this.cssSelector.jPlayer).jPlayer("setMedia",this.playlist[this.current]),console.log(this.playlist[this.current])):this.current=0},setCurrent:function(t){t<0&&(t=0),console.log("setCurrent "+t),t>=0&&this.current!==t&&(this.current=t),this._highlight(t)},play:function(s){console.log("play "+s),s=s<0?this.playlist.length+s:s,"function"==typeof this.options.callbackPlay&&this.options.callbackPlay(s),0<=s&&s<this.playlist.length?this.playlist.length&&(this.select(s),t(this.cssSelector.jPlayer).jPlayer("play")):void 0===s&&t(this.cssSelector.jPlayer).jPlayer("play"),startIndex=s-this.options.playlistOptions.removeCount,s>0&&!this.loop&&this.options.playlistOptions.removePlayed&&startIndex>0&&!this.options.loopBack&&(console.log("index "+s),console.log("startIndex "+startIndex),this.removeBefore(startIndex),this._refreshHtmlPlaylist())},pause:function(){t(this.cssSelector.jPlayer).jPlayer("pause")},next:function(){var t=this.current+1<this.playlist.length?this.current+1:0;console.log("next "+t),this.loop?this.play(this.current):t>0||0===t&&this.options.loopBack?this.play(t):(startIndex=this.current+1-this.options.playlistOptions.removeCount,0===t&&this.options.playlistOptions.removePlayed&&!this.options.loopBack&&(console.log("startIndex "+startIndex),this.removeBefore(startIndex)))},previous:function(){var t=this.current-1>=0?this.current-1:this.playlist.length-1;(this.loop&&this.options.playlistOptions.loopOnPrevious||t<this.playlist.length-1)&&this.play(t)},shuffle:function(){var s=this;s.shuffling||(console.log("shuffle"),s.shuffling=!0,t(this.cssSelector.playlist+" ul").slideUp(this.options.playlistOptions.shuffleTime,function(){var e=s.playlist[s.current],l=[],i=[];l.push(e),t.each(s.playlist,function(t,s){s!==e&&i.push(s)}),i.sort(function(t,s){return.5-Math.random()}),t.each(i,function(t,s){l.push(s)}),s.playlist=l,s.current=0,s.shuffling=!1,s._refresh(!0),s._highlight(0),t(this).slideDown(s.options.playlistOptions.shuffleTime)}),console.log("current: "+s.current),console.log(playlist_before),console.log(s.playlist),console.log("-----------"))},toggleLoop:function(t){console.log("toggleLoop"),this.options.loopBack=t},blur:function(s){t(this.cssSelector.jPlayer).jPlayer("option","autoBlur")&&t(s).blur()}}}(jQuery);
