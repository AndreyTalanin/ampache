/*! jPlayerPlaylist for jPlayer 2.9.2 ~ (c) 2009-2014 Happyworm Ltd ~ MIT License */
!function(n){jPlayerPlaylist=function(t,s,i){var e=this;this.current=0,this.loop=!1,this.shuffled=!1,this.removing=!1,this.cssSelector=n.extend({},this._cssSelector,t),this.options=n.extend(!0,{keyBindings:{next:{key:221,fn:function(){e.next()}},previous:{key:219,fn:function(){e.previous()}},shuffle:{key:83,fn:function(){e.shuffle()}}},stateClass:{shuffled:"jp-state-shuffled"}},this._options,i),this.playlist=[],this.original=[],this._initPlaylist(s),this.cssSelector.details=this.cssSelector.cssSelectorAncestor+" .jp-details",this.cssSelector.playlist=this.cssSelector.cssSelectorAncestor+" .jp-playlist",this.cssSelector.next=this.cssSelector.cssSelectorAncestor+" .jp-next",this.cssSelector.previous=this.cssSelector.cssSelectorAncestor+" .jp-previous",this.cssSelector.shuffle=this.cssSelector.cssSelectorAncestor+" .jp-shuffle",this.cssSelector.shuffleOff=this.cssSelector.cssSelectorAncestor+" .jp-shuffle-off",this.options.cssSelectorAncestor=this.cssSelector.cssSelectorAncestor,this.options.repeat=function(t){e.loop=t.jPlayer.options.loop},n(this.cssSelector.jPlayer).bind(n.jPlayer.event.ready,function(){e._init()}),n(this.cssSelector.jPlayer).bind(n.jPlayer.event.ended,function(){e.next()}),n(this.cssSelector.jPlayer).bind(n.jPlayer.event.play,function(){n(this).jPlayer("pauseOthers")}),n(this.cssSelector.jPlayer).bind(n.jPlayer.event.resize,function(t){t.jPlayer.options.fullScreen?n(e.cssSelector.details).show():n(e.cssSelector.details).hide()}),n(this.cssSelector.previous).click(function(t){t.preventDefault(),e.previous(),e.blur(this)}),n(this.cssSelector.next).click(function(t){t.preventDefault(),e.next(),e.blur(this)}),n(this.cssSelector.shuffle).click(function(t){t.preventDefault(),e.shuffled&&n(e.cssSelector.jPlayer).jPlayer("option","useStateClassSkin")?e.shuffle(!1):e.shuffle(!0),e.blur(this)}),n(this.cssSelector.shuffleOff).click(function(t){t.preventDefault(),e.shuffle(!1),e.blur(this)}).hide(),this.options.fullScreen||n(this.cssSelector.details).hide(),n(this.cssSelector.playlist+" ul").empty(),this._createItemHandlers(),n(this.cssSelector.jPlayer).jPlayer(this.options)},jPlayerPlaylist.prototype={_cssSelector:{jPlayer:"#jquery_jplayer_1",cssSelectorAncestor:"#jp_container_1"},_options:{playlistOptions:{autoPlay:!1,loopOnPrevious:!1,shuffleOnLoop:!0,enableRemoveControls:!1,displayTime:"slow",addTime:"fast",removeTime:"fast",shuffleTime:"slow",itemClass:"jp-playlist-item",freeGroupClass:"jp-free-media",freeItemClass:"jp-playlist-item-free",removeItemClass:"jp-playlist-item-remove"}},option:function(t,s){if(void 0===s)return this.options.playlistOptions[t];switch(this.options.playlistOptions[t]=s,t){case"enableRemoveControls":this._updateControls();break;case"itemClass":case"freeGroupClass":case"freeItemClass":case"removeItemClass":this._refresh(!0),this._createItemHandlers()}return this},_init:function(){var t=this;this._refresh(function(){t.options.playlistOptions.autoPlay?t.play(t.current):t.select(t.current)})},_initPlaylist:function(t){this.current=0,this.shuffled=!1,this.removing=!1,this.original=n.extend(!0,[],t),this._originalPlaylist()},_originalPlaylist:function(){var s=this;this.playlist=[],n.each(s.original,function(t){s.playlist[t]=s.original[t]})},_refresh:function(t){var s,i=this;t&&!n.isFunction(t)?(n(this.cssSelector.playlist+" ul").empty(),n.each(i.playlist,function(t){n(i.cssSelector.playlist+" ul").append(i._createListItem(i.playlist[t]))}),this._updateControls()):(s=n(this.cssSelector.playlist+" ul").children().length?this.options.playlistOptions.displayTime:0,n(this.cssSelector.playlist+" ul").slideUp(s,function(){var s=n(this);n(this).empty(),n.each(i.playlist,function(t){s.append(i._createListItem(i.playlist[t]))}),i._updateControls(),n.isFunction(t)&&t(),i.playlist.length?n(this).slideDown(i.options.playlistOptions.displayTime):n(this).show()}))},_refreshHtmlPlaylist:function(){var i=this,e=!1;n.each(n(this.cssSelector.playlist+" ul li"),function(t,s){parseInt(n(s).attr("name"),10)!==t&&(e||i.current!==parseInt(n(s).attr("name"),10)||(i.current=t,e=!0),n(s).attr("name",t))})},_createListItem:function(t){var s=' class="playlist-row ';"string"==typeof t.attrClass&&(s+=t.attrClass);s="<li"+(s+='" ')+' name="'+n(jplaylist.cssSelector.playlist+" ul li").length+'" data-poster="'+t.poster+'" data-media_id="'+t.media_id+'" data-album_id="'+t.album_id+'" data-artist_id="'+t.artist_id+'" data-replaygain_track_gain="'+t.replaygain_track_gain+'" data-replaygain_track_peak="'+t.replaygain_track_peak+'" data-replaygain_album_gain="'+t.replaygain_album_gain+'" data-replaygain_album_peak="'+t.replaygain_album_peak+'" data-r128_track_gain="'+t.r128_track_gain+'" data-r128_album_gain="'+t.r128_album_gain+'"><div>';return s+="<a href='javascript:;' class='"+this.options.playlistOptions.removeItemClass+"'>&times;</a>",t.media_id&&(s+='<span class="jp-free-media menu"><a></a></span>'),s+="<a href='javascript:;' class='"+this.options.playlistOptions.itemClass+"' tabindex='1'>"+t.title+(t.artist?" <span class='jp-artist'>by "+t.artist+"</span>":"")+"</a>",s+="</div></li>"},_createItemHandlers:function(){var s=this;n(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.itemClass).on("click","a."+this.options.playlistOptions.itemClass,function(t){t.preventDefault();t=n(this).parent().parent().index();s.current!==t?s.play(t):n(s.cssSelector.jPlayer).jPlayer("play"),s.blur(this)}),n(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.freeItemClass).on("click","a."+this.options.playlistOptions.freeItemClass,function(t){t.preventDefault(),n(this).parent().parent().find("."+s.options.playlistOptions.itemClass).click(),s.blur(this)}),n(this.cssSelector.playlist).off("click","a."+this.options.playlistOptions.removeItemClass).on("click","a."+this.options.playlistOptions.removeItemClass,function(t){t.preventDefault();t=n(this).parent().parent().index();s.remove(t),s.blur(this)})},_updateControls:function(){this.options.playlistOptions.enableRemoveControls?n(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).show():n(this.cssSelector.playlist+" ."+this.options.playlistOptions.removeItemClass).hide(),this.shuffled?n(this.cssSelector.jPlayer).jPlayer("addStateClass","shuffled"):n(this.cssSelector.jPlayer).jPlayer("removeStateClass","shuffled"),n(this.cssSelector.shuffle).length&&n(this.cssSelector.shuffleOff).length&&(this.shuffled?(n(this.cssSelector.shuffleOff).show(),n(this.cssSelector.shuffle).hide()):(n(this.cssSelector.shuffleOff).hide(),n(this.cssSelector.shuffle).show()))},_highlight:function(t){n(this.cssSelector.title+" li:first").html("Playlist: "+this.name),n(this.cssSelector.title+" li:last").html(" "),this.playlist.length&&void 0!==t&&(n(this.cssSelector.playlist+" .jp-playlist-current").removeClass("jp-playlist-current"),n(this.cssSelector.playlist+" li:nth-child("+(t+1)+")").addClass("jp-playlist-current").find(".jp-playlist-item").addClass("jp-playlist-current"),n(this.cssSelector.title+" li:last").html(this.playlist[t].title+(this.playlist[t].artist?" <span class='jp-artist'>by "+this.playlist[t].artist+"</span>":"")))},setPlaylist:function(t){this._initPlaylist(t),this._init()},add:function(t,s){n(this.cssSelector.playlist+" ul").append(this._createListItem(t)).find("li:last-child").hide().slideDown(this.options.playlistOptions.addTime),this._updateControls(),this.original.push(t),this.playlist.push(t),s?this.play(this.playlist.length-1):1===this.original.length&&this.select(0)},addAfter:function(s,i){var e,l,a;i>=this.original.length||i<0?console.log("jPlayerPlaylist.addAfter: ERROR, Index out of bounds"):(e=this,l=[],a=[],n.each(e.playlist,function(t){l[t]=e.playlist[t]}),n(this.cssSelector.playlist+" ul").find("li[name="+i+"]").after(this._createListItem(s)).end().find("li:last-child").hide().slideDown(this.options.playlistOptions.addTime),this._updateControls(),n.each(e.playlist,function(t){a.push(l[t]),t===i&&a.push(s)}),this.playlist=a,this.original=a,1===this.original.length&&this.select(0),this._refreshHtmlPlaylist())},remove:function(s){var t,i=this,e=[],l=[];return n.each(i.playlist,function(t){e[t]=i.playlist[t]}),void 0===s?(this._initPlaylist([]),this._refresh(function(){n(i.cssSelector.jPlayer).jPlayer("clearMedia")}),!0):!this.removing&&(0<=(s=s<0?this.playlist.length+s:s)&&s<this.playlist.length&&(this.removing=!0,"playlist"===jplaylist.type&&(t=n(n(".jp-playlist-item-remove")[s]).parent().parent().attr("track_id"),jplaylist.rmTrack(t,jplaylist.name)),n(this.cssSelector.playlist+" li:nth-child("+(s+1)+")").slideUp(this.options.playlistOptions.removeTime,function(){n(this).remove(),i.original.length?s===i.current?(i.current=s<i.original.length?i.current:i.original.length-1,i.select(i.current)):s<i.current&&i.current--:(n(i.cssSelector.jPlayer).jPlayer("clearMedia"),i.current=0,i.shuffled=!1,i._updateControls()),i.removing=!1,i._refreshHtmlPlaylist()}),n.each(i.playlist,function(t){t!==s&&l.push(e[t])}),this.playlist=l,this.original=l),!0)},removeAll:function(){this.original=[],this._originalPlaylist(),n(this.cssSelector.playlist+" ul").html(" ")},rmTrack:function(t,s){s=s||"default",n.post("/playlist/rmtrack",{playlist:s,trackId:t},function(t){"error"===t[1]&&n.loadPlaylist()},"json").error(function(t){n.bootstrapMessageAuto("An error occurred while trying to remove the track from your playlist.","error")})},scan:function(){var e=this,l=!1,a=[],r=[];n.each(e.playlist,function(t){a[t]=e.playlist[t]}),n.each(n(this.cssSelector.playlist+" ul li"),function(t,s){var i=parseInt(n(s).attr("name"),10);i!==t&&(l||e.current!==i||(e.current=t,l=!0),n(s).attr("name",t)),r.push(a[i])}),this.playlist=r,this.original=r},select:function(t){0<=(t=t<0?this.original.length+t:t)&&t<this.playlist.length?(this.current=t,this._highlight(t),n(this.cssSelector.jPlayer).jPlayer("setMedia",this.playlist[this.current])):this.current=0},setCurrent:function(t){this.current=t,this.select(this.current)},play:function(t){t=t<0?this.original.length+t:t,"function"==typeof this.options.callbackPlay&&this.options.callbackPlay(t),0<=t&&t<this.playlist.length?this.playlist.length&&(this.select(t),n(this.cssSelector.jPlayer).jPlayer("play")):void 0===t&&n(this.cssSelector.jPlayer).jPlayer("play")},pause:function(){n(this.cssSelector.jPlayer).jPlayer("pause")},next:function(){var t=this.current+1<this.playlist.length?this.current+1:0;this.loop?0===t&&this.shuffled&&this.options.playlistOptions.shuffleOnLoop&&1<this.playlist.length?this.shuffle(!0,!0):this.play(t):0<t&&this.play(t)},previous:function(){var t=0<=this.current-1?this.current-1:this.playlist.length-1;(this.loop&&this.options.playlistOptions.loopOnPrevious||t<this.playlist.length-1)&&this.play(t)},shuffle:function(t,s){var e=this;void 0===t&&(t=!this.shuffled),!t&&t===this.shuffled||n(this.cssSelector.playlist+" ul").slideUp(this.options.playlistOptions.shuffleTime,function(){var i;(e.shuffled=t)?(i=e.playlist[e.current],e.playlist.sort(function(a,b){return.5-Math.random()}),n.each(e.playlist,function(t,s){if(e.playlist[t]===i)return e.current=t,!1}),e.shuffled=!1,e._refresh(!0),e.play(e.current)):(e.shuffled=!1,e._refresh(!0),e.select(e.current)),this.original=this.playlist,n(this).slideDown(e.options.playlistOptions.shuffleTime)})},blur:function(t){n(this.cssSelector.jPlayer).jPlayer("option","autoBlur")&&n(t).blur()}}}(jQuery);
